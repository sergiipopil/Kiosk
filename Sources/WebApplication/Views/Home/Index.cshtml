@model WebApplication.Models.RightTreeViewModel
@{
    ViewData["Title"] = "Home Page";
}
<!DOCTYPE html>

<html>
<head>
    <link href="~/css/site.css" rel="stylesheet" />
    <script src="https://yastatic.net/jquery/3.3.1/jquery.min.js"></script>
    <meta name="viewport" charset="utf-8" content="width=device-width, initial-scale=1" />
    <style>
    </style>
    <script type="text/javascript">
        $(document).ready(function () {
            if (window.location.toString().includes("carManufactureName"))
            {
                var carManufactureName = getUrlParameter('carManufactureName');
                var carModel = getUrlParameter('carModel');
                if (carManufactureName != "" && carModel == false) {
                    selectManufacturer(carManufactureName);
                }
                var mainCategoryId = getUrlParameter('mainCategoryId');
                if (carManufactureName != "" && carModel != "" && mainCategoryId == false) {
                    selectCarModel(carManufactureName, carModel);
                }
                var mainCategoryName = getUrlParameter('mainCategoryName');
                var subCategoryId = getUrlParameter('subCategoryId');
                var subCategoryName = getUrlParameter('subCategoryName');
                var subChildId = getUrlParameter('subChildId');
                var subChildName = getUrlParameter('subChildName');
                if (carManufactureName != "" && carModel != "" && mainCategoryId != "" && subCategoryId == false) {
                    selectMainCategory(carManufactureName, carModel, mainCategoryId, mainCategoryName);
                }
                if (subChildId == "" && subChildName == "") {
                    selectSubMainCategory(carManufactureName, carModel, mainCategoryId, mainCategoryName, subCategoryId, subCategoryName);
                }
                else {
                    getAllegroData(carManufactureName, carModel, mainCategoryId, mainCategoryName, subCategoryId, subCategoryName, subChildId, subChildName);
                }
            }
            if (getUrlParameter('partNumber') != false) {
                $("#inputPartValue").val(getUrlParameter('partNumber'));
                submit();
            }
        });
        var getUrlParameter = function getUrlParameter(sParam) {
            var sPageURL = window.location.search.substring(1),
                sURLVariables = sPageURL.split('&'),
                sParameterName,
                i;

            for (i = 0; i < sURLVariables.length; i++) {
                sParameterName = sURLVariables[i].split('=');

                if (sParameterName[0] === sParam) {
                    return typeof sParameterName[1] === undefined ? true : decodeURIComponent(sParameterName[1]);
                }
            }
            return false;
        };
        function submit() {
            $('#divSelectTopCategory').hide();
            $('#divCarManufactures').empty();
            $('#divCarManufactures').html('<div style="text-align: center; padding-top: 30%; display: block;"><img src="/images/load.gif" width="100px" /></div>');
        $.ajax({
            type: "GET",
            url: '@Url.Action("PartNumberInput", "Home")' + "?partNumber=" + $("#inputPartValue").val(),
            success: function (data) {
                $('#divCarManufactures').empty();
                $('#divCarManufactures').html(data);
            }
        });
        }
        function topCategorySelected() {
            ViewData["Title"] = "Home Page";
        }
        function back() {
            showMainView();
            $("input#inputPartValue").val("");
            $('#divSearchByPartNumber').show();
            $('#divBreadcrumbs').hide();
            $('#divSelectTopCategory').show();
        }
        function BreadCrumbsHistory(manufacture, model, mainCategoryId, mainCategoryName, subCategoryId, subCategoryName, subChildId, subChildName) {
            $('#divBreadcrumbsItems').empty();
            $('#divBreadcrumbs').show();
            $('#divSearchByPartNumber').hide();
            $('#divSelectTopCategory').hide();
            if (manufacture != null && manufacture != "") {
                $('#divBreadcrumbsItems').append(`<div id="divBreadcrumbsManufacture" onclick="selectManufacturer('${manufacture}')"><div class="parentDivBreadCrumbs">
                <div style="min-width:155px;min-height:115px;text-align:center;"><img src="/images/Catalog/Model_Logo/${manufacture}.png" class="manufactureImageBreadcrumbs" /></div></div></div>`);
            }
            if (model != null && model != "") {

                $('#divBreadcrumbsItems').append(`<div id="divBreadcrumbsModel" class="parentDivBreadCrumbs" onclick="selectCarModel('${manufacture}', '${model}')" style="display:grid;">
                <div style="min-width:155px;min-height:100px;max-height:100px;text-align:center;"><img src="/images/Catalog/CarModel/${manufacture}/${model}.png" class="manufactureImageBreadcrumbs" /></div><div class="manufactureTextBreadcrumbs"><span style="color:black;">${model}</span>
                            </div></div>`);
            }
            if (mainCategoryName != null) {
                $('#divBreadcrumbsItems').append(`<div id="divBreadcrumbsMainCategory" class="parentDivBreadCrumbs" onclick="selectMainCategory('${manufacture}', '${model}', '${mainCategoryId}', '${mainCategoryName}')" style="display:grid;">
                <div style="min-width:155px;min-height:90px;text-align:center;"><img src="/images/Catalog/AutoParts/${mainCategoryId}.png" class="manufactureImageCategoryBreadcrumbs" /></div><div class="manufactureTextBreadcrumbs"><span style="color:black;">${mainCategoryName}</span>
                            </div></div>`);
            }
            if (subCategoryName != null) {
                $('#divBreadcrumbsItems').append(`<div id="divBreadcrumbsSubCategory" class="parentDivBreadCrumbs" onclick="selectSubMainCategory('${manufacture}', '${model}', '${mainCategoryId}', '${mainCategoryName}', '${subCategoryId}', '${subCategoryName}')" style="display:grid;">
                <div style="min-width:155px;min-height:90px;text-align:center;"><img src="/images/Catalog/AutoParts/${subCategoryId}.png" class="manufactureImageCategoryBreadcrumbs" /></div><div class="manufactureTextBreadcrumbs"><span style="color:black;">${subCategoryName}</span>
                            </div></div>`);
            }
            if (subChildName != null) {
                $('#divBreadcrumbsItems').append(`<div id="divBreadcrumbsSubChildCategory" class="parentDivBreadCrumbs" style="display:grid;">
                <div style="min-width:155px;min-height:90px;text-align:center;"><img src="/images/Catalog/AutoParts/${subChildId}.png" class="manufactureImageCategoryBreadcrumbs" /></div><div class="manufactureTextBreadcrumbs"><span style="color:black;">${subChildName}</span>
                            </div></div>`);
            }
        }
        function onAjaxFailure(xhr, status, error) {
            $("#targetElement").html("<strong>An error occurred retrieving data:" + error + "<br/>.</strong>");
        }
        function onAjaxSuccess(data, status, xhr) {
            if (!$.trim(data)) {
                $("#targetElement").html("<div class='text-center'><strong>No results found for search.</strong></div>");
            }
        }
    function selectCarModel(manufacture, model) {
        $('#divSelectTopCategory').hide();
        $.ajax({
            type: "GET",
            url: '@Url.Action("ShowCategoryAutoParts", "Home")' + "?carManufactureName=" + manufacture + "&carModel=" + model,
            success: function (data) {
                if (model != "" && model != null) {
                    BreadCrumbsHistory(manufacture, model);
                }
                $('#divCarManufactures').empty();
                $('#divCarManufactures').html(data);
                if (model != "" && model != null) {
                    window.history.pushState($('#filter'), 'title', "?carManufactureName=" + manufacture + "&carModel=" + model);
                }
                else {
                    $('#divBreadcrumbs').hide();
                    $('#divSearchByPartNumber').show();
                    $('#divSelectTopCategory').show();
                }
            }
        });
        return false;
    }
        function selectMainCategory(manufacture, model, mainCategoryId, mainCategoryName) {
        $('#divSelectTopCategory').hide();
        $.ajax({
            type: "GET",
            url: '@Url.Action("ShowMainSubcategories", "Home")' + "?carManufactureName=" + manufacture + "&carModel=" + model + "&mainCategoryId=" + mainCategoryId + "&mainCategoryName=" + mainCategoryName,
            success: function (data) {
                BreadCrumbsHistory(manufacture, model, mainCategoryId, mainCategoryName);
                $('#divCarManufactures').empty();
                $('#divCarManufactures').html(data);
                window.history.pushState($('#filter'), 'title', "?carManufactureName=" + manufacture + "&carModel=" + model + "&mainCategoryId=" + mainCategoryId + "&mainCategoryName=" + mainCategoryName);
            }
        });
    }
        function selectSubMainCategory(manufacture, model, mainCategoryId, mainCategoryName, subCategoryId, subCategoryName) {
            $('#divCarManufactures').empty();
            $('#divCarManufactures').html('<div style="text-align: center; padding-top: 30%; display: block;"><img src="/images/load.gif" width="100px" /></div>');

        $('#divSelectTopCategory').hide();
        $.ajax({
            type: "GET",
            url: '@Url.Action("ShowMainSubChildsCategories", "Home")' + "?carManufactureName=" + manufacture + "&carModel=" + model + "&mainCategoryId=" + mainCategoryId + "&mainCategoryName=" + mainCategoryName +
                 "&subCategoryId=" + subCategoryId + "&subCategoryName=" + subCategoryName,
            success: function (data) {
                console.log("start");
                BreadCrumbsHistory(manufacture, model, mainCategoryId, mainCategoryName, subCategoryId, subCategoryName);
                $('#divCarManufactures').empty();
                $('#divCarManufactures').html(data);
                window.history.pushState($('#filter'), 'title', "?carManufactureName=" + manufacture + "&carModel=" + model + "&mainCategoryId=" + mainCategoryId + "&mainCategoryName=" + mainCategoryName +
                    "&subCategoryId=" + subCategoryId + "&subCategoryName=" + subCategoryName);
            }
        });
    }
        function getAllegroData(manufacture, model, mainCategoryId, mainCategoryName, subCategoryId, subCategoryName, subChildId, subChildName) {
            $('#divSelectTopCategory').hide();
            $('#divCarManufactures').empty();
            $('#divCarManufactures').html('<div style="text-align: center; padding-top: 30%; display: block;"><img src="/images/load.gif" width="100px" /></div>');
        $.ajax({
            type: "GET",
            url: '@Url.Action("ShowProductList", "Home")' + "?carManufactureName=" + manufacture + "&carModel=" + model + "&mainCategoryId=" + mainCategoryId + "&mainCategoryName=" + mainCategoryName +
                "&subCategoryId=" + subCategoryId + "&subCategoryName=" + subCategoryName + "&subChildId=" + subChildId + "&subChildName=" + subChildName,
            success: function (data) {
               BreadCrumbsHistory(manufacture, model, mainCategoryId, mainCategoryName, subCategoryId, subCategoryName, subChildId, subChildName);
               $('#divCarManufactures').empty();
                $('#divCarManufactures').html(data);
                window.history.pushState($('#filter'), 'title', "?carManufactureName=" + manufacture + "&carModel=" + model + "&mainCategoryId=" + mainCategoryId + "&mainCategoryName=" + mainCategoryName +
                    "&subCategoryId=" + subCategoryId + "&subCategoryName=" + subCategoryName + "&subChildId=" + subChildId + "&subChildName=" + subChildName);
            }
        });
    }
        function FilteredList(state, sorting, page) {
            $('#divCarManufactures').empty();
            $('#divCarManufactures').html('<div style="text-align: center; padding-top: 30%; display: block;"><img src="/images/load.gif" width="100px" /></div>');
            $.ajax({
                type: "GET",
                url: '@Url.Action("FilteredList", "Home")' + "?state=" + state + "&sorting=" + sorting + "&page=" + page,
            success: function (data) {
               $('#divCarManufactures').empty();
                $('#divCarManufactures').html(data);
            }
        });
        }

    function selectManufacturer(carManufactureName) {
        $.ajax({
            type: "GET",
            url: '@Url.Action("SelectManufactureAndModel", "Home")' + "?carManufactureName=" + carManufactureName,
            success: function (data) {
                if (carManufactureName != "" && carManufactureName != null) {
                    BreadCrumbsHistory(carManufactureName);
                }
                $('#divCarManufactures').empty();
                $('#divCarManufactures').html(data);
                if (carManufactureName != "" && carManufactureName != null) {
                    window.history.pushState($('#filter'), 'title', "?carManufactureName=" + carManufactureName);
                }
                else {
                    $('#divBreadcrumbs').hide();
                    $('#divSearchByPartNumber').show();
                    $('#divSelectTopCategory').show();
                    $('div[id*="divTopCategory_"]').removeClass("selected");
                    $('#divTopCategory_620').addClass("selected");
                }
            }
        });
        return false;
        }

        function goToCart(selectedProductId) {
            window.open('/Product/CartView/' + "?selectedProductId=" + selectedProductId);
        }
        function showMainView(topCategoryId) {
            $('div[id*="divTopCategory_"]').removeClass("selected");
            $('#divTopCategory_' + topCategoryId).addClass("selected");
        $.ajax({
            type: "GET",
            url: '@Url.Action("ShowMainView", "Home")' + "?topCategoryId=" + topCategoryId,
            success: function (data) {
                $('#divCarManufactures').empty();
                $('#divCarManufactures').html(data);
            }
        });
        }
    </script>
</head>
<body>
    <table style="min-height: 100vh;min-width:100%;">
        <tr>
            @*LEFT PANEL*@
            <td class="leftIndexPanel">
                <div id="divSearchByPartNumber">
                    <img src="~/images/Catalog/LoupeBackground1.png" style="margin-top:25%" />
                    @*FIND DETAIL BY INPUT SEARCH*@
                    <div style="font-size:60px;vertical-align:top;text-align:center;">
                        <div style="margin-top: -40%;text-align:left;padding-left:25px;">
                            <span>Знайдіть деталь <br> по </span><span style="color:#ff5a00;font-size:48px;">номеру або назві запчастини</span>
                        </div>
                    </div>
                    <div>
                        <div style="margin:80px 25px 0px 25px; background:white;padding:0px 10px 8px 10px;box-shadow:0px 0px 10px #ff5a00;">
                            <div style="display:inline-block;vertical-align:middle;width:85%;">@Html.TextBoxFor(m => m.PartNumberValue, new { @placeholder = "Що шукаєте?", @id = "inputPartValue", @class = "inputPart" })</div>
                            <div class="loopBtn" onclick="submit()"><img style="padding-bottom:10px;" src="~/images/Catalog/InputLoupe.png"></div>
                        </div>
                    </div>
                </div>
                @*START BREADCRUMBS BLOCK*@
                <div id="divBreadcrumbs" style="display:none;text-align:center;">
                    <div>Ви вибрали:</div>
                    <div id="divBreadcrumbsItems" style="margin:0% 36%;">
                    </div>
                </div>
                @*END BREADCRUMBS BLOCK*@
            </td>



            @*RIGHT PANEL*@
            <td class="rightIndexPanel">
                @*SELECT TOP CATEGORY PANEL*@
                <div id="divSelectTopCategory">
                    <div class="mainBlockTitle">Виберіть розділ</div>
                    <div style="padding: 20px 0px 28px 0px;">
                        <div class="inline-block">
                            <div class="topCategoryDiv selected" style="display:grid;" id="divTopCategory_620" onclick="showMainView('620')">
                                <div style="text-align:center;">
                                    <img src="~/images/Catalog/Categories/New/Europe_CarTruckParts.png" class="TopCategoryImage" />
                                </div>
                                <div class="manufactureText">
                                    <span>Легкові і мікроавтобуси</span>
                                </div>
                            </div>
                        </div>
                        <div class="inline-block">
                            <div class="topCategoryDiv" style="display:grid;" id="divTopCategory_621" onclick="showMainView('621')">
                                <div style="text-align:center;">
                                    <img src="~/images/Catalog/Categories/New/Europe_TruckParts.png" class="TopCategoryImage" />
                                </div>
                                <div class="manufactureText">
                                    <span>Грузові</span>
                                </div>
                            </div>
                        </div>
                        <div class="inline-block">
                            <div class="topCategoryDiv" style="display:grid;" id="divTopCategory_622" onclick="showMainView('622')">
                                <div style="text-align:center;">
                                    <img src="~/images/Catalog/Categories/New/Europe_BusParts.png" class="TopCategoryImage" />
                                </div>
                                <div class="manufactureText">
                                    <span>Автобуси</span>
                                </div>
                            </div>
                        </div>
                        <div class="inline-block">
                            <div class="topCategoryDiv" style="display:grid;" id="divTopCategory_99022" onclick="showMainView('99022')">
                                <div style="text-align:center;">
                                    <img src="~/images/Catalog/Categories/New/CarType_Special.png" class="TopCategoryImage" />
                                </div>
                                <div class="manufactureText">
                                    <span>Спецтехніка</span>
                                </div>
                            </div>
                        </div>
                        <div class="inline-block">
                            <div class="topCategoryDiv" style="display:grid;" id="divTopCategory_156" onclick="showMainView('156')">
                                <div style="text-align:center;">
                                    <img src="~/images/Catalog/Categories/New/CarType_Moto.png" class="TopCategoryImage" />
                                </div>
                                <div class="manufactureText">
                                    <span>Мотоцикли</span>
                                </div>
                            </div>
                        </div>
                        <div class="inline-block">
                            <div class="topCategoryDiv" style="display:grid;" id="divTopCategory_99193" onclick="showMainView('99193')">
                                <div style="text-align:center;">
                                    <img src="~/images/Catalog/Categories/New/Europe_TiresAndRims.png" class="TopCategoryImage" />
                                </div>
                                <div class="manufactureText">
                                    <span>Шини і дисик</span>
                                </div>
                            </div>
                        </div>
                        <div class="inline-block">
                            <div class="topCategoryDiv" style="display:grid;" id="divTopCategory_18554" onclick="showMainView('18554')">
                                <div style="text-align:center;">
                                    <img src="~/images/Catalog/Categories/New/Europe_Tools.png" class="TopCategoryImage" />
                                </div>
                                <div class="manufactureText">
                                    <span>Інструменти і обладнання</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                @*CAR MANUFACTURE TREE*@
                <div id="divCarManufactures">
                    @Html.Partial("_CarTree", @Model)
                </div>
            </td>
        </tr>
    </table>
</body>
</html>